<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generar PDF de Tabla de Servicios</title>
    <link rel="stylesheet" href="./css/estilosPDFServ.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</head>
<body>
    <main>
        <h1><img src="./sources/logo_spa2.png"></h1>
        <h1>Lista de Servicios</h1>
        <table id="tablaServiciosPDF">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Título</th>
                    <th>Tipo de Servicio</th>
                    <th>Descripción</th>
                    <th>Ruta Imagen</th>
                    <th>Duración (min)</th>
                    <th>Precio</th>
                    <th>Empleado ID</th>
                    <th>Nombre de Usuario</th>
                </tr>
            </thead>
            <tbody>
                <!-- Aquí se insertarán las filas dinámicamente desde JS -->
            </tbody>
        </table>

        <div class="botonesAccion">
            <button id="btnDescargarPDF">Descargar PDF</button>
            <button id="btnImprimir">Imprimir</button>
            <button id="btnVolver">Volver</button>
        </div>
    </main>

    <script>
        const servicios = JSON.parse(localStorage.getItem('servicios')) || [];

        async function obtenerNombreUsuarioPorId(usuarioId) {
            try {
                const response = await fetch(`https://apispademo.somee.com/api/Usuario/${usuarioId}`);
                if (!response.ok) {
                    throw new Error('Error al obtener los datos del usuario');
                }
                const usuario = await response.json();
                return usuario.userName;
            } catch (error) {
                console.error('Error al obtener el nombre de usuario:', error);
                return 'No disponible';
            }
        }

        async function cargarServiciosEnTabla() {
            const tablaCuerpo = document.querySelector('#tablaServiciosPDF tbody');
            tablaCuerpo.innerHTML = '';

            for (const servicio of servicios) {
                const nombreUsuario = await obtenerNombreUsuarioPorId(servicio.usuarioId);

                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${servicio.servicioId}</td>
                    <td>${servicio.titulo}</td>
                    <td>${servicio.tipoServicio}</td>
                    <td>${servicio.descripcion}</td>
                    <td>${servicio.rutaImagen}</td>
                    <td>${servicio.duracionMinut}</td>
                    <td>${servicio.precio}</td>
                    <td>${servicio.usuarioId}</td>
                    <td>${nombreUsuario}</td>
                `;
                tablaCuerpo.appendChild(fila);
            }
        }

        cargarServiciosEnTabla();

        document.getElementById('btnDescargarPDF').addEventListener('click', function() {
            const element = document.querySelector('main');
            html2pdf().from(element).save('Servicios.pdf');
        });

        document.getElementById('btnImprimir').addEventListener('click', function() {
            window.print();
        });

        document.getElementById('btnVolver').addEventListener('click', function() {
            window.location.href = 'indexpersonal.html';
        });
    </script>
</body>
</html>


